<!DOCTYPE html>
<html>
<head>
    <title>Galactic Pass-Through</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
        // Custom component to create a galaxy of particles
        AFRAME.registerComponent('galaxy', {
            schema: {
                radius: {type: 'number', default: 5},
                particleCount: {type: 'number', default: 1000},
                color: {type: 'string', default: 'white'},
                shape: {type: 'string', default: 'spiral'} // spiral, elliptical, irregular
            },
            init: function() {
                const data = this.data;
                const el = this.el;

                const material = new THREE.PointsMaterial({
                    size: 0.1,
                    vertexColors: true,
                    map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/sprites/disc.png'),
                    transparent: true,
                    blending: THREE.AdditiveBlending,
                    opacity: 0.8
                });

                const particlesGeometry = new THREE.BufferGeometry();
                const positions = [];
                const colors = [];

                const colorBase = new THREE.Color(data.color);

                for (let i = 0; i < data.particleCount; i++) {
                    const r = Math.pow(Math.random(), 0.5) * data.radius;
                    const theta = Math.random() * 2 * Math.PI;
                    const phi = Math.acos(Math.random() * 2 - 1);

                    let x, y, z;

                    if (data.shape === 'spiral') {
                        const arm = Math.floor(Math.random() * 2) * 2 * Math.PI; // Two spiral arms
                        const distance = Math.sqrt(r);
                        const angle = theta + distance * 5 + arm;
                        x = Math.cos(angle) * r;
                        z = Math.sin(angle) * r;
                        y = (Math.random() - 0.5) * r * 0.1;
                    } else if (data.shape === 'elliptical') {
                        x = r * Math.sin(phi) * Math.cos(theta);
                        y = r * Math.sin(phi) * Math.sin(theta);
                        z = r * Math.cos(phi);
                    } else { // irregular
                        x = (Math.random() - 0.5) * data.radius * 2;
                        y = (Math.random() - 0.5) * data.radius * 2;
                        z = (Math.random() - 0.5) * data.radius * 2;
                    }

                    positions.push(x, y, z);

                    const color = colorBase.clone();
                    color.multiplyScalar(0.5 + Math.random() * 0.5);
                    colors.push(color.r, color.g, color.b);
                }

                particlesGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
                particlesGeometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

                const points = new THREE.Points(particlesGeometry, material);
                el.setObject3D('particles', points);
            }
        });

        // Generates galaxies
        function generateGalaxies() {
            const sceneEl = document.querySelector('a-scene');
            const galaxyCount = 30; // Number of galaxies
            const minDistance = 20; // Minimum distance from the origin

            const galaxyShapes = ['spiral', 'elliptical', 'irregular'];
            const galaxyColors = ['#ADD8E6', '#FFD700', '#9370DB', '#FF6347', '#E6E6FA'];

            for (let i = 0; i < galaxyCount; i++) {
                const el = document.createElement('a-entity');
                const shape = galaxyShapes[Math.floor(Math.random() * galaxyShapes.length)];
                const color = galaxyColors[Math.floor(Math.random() * galaxyColors.length)];
                const radius = Math.random() * 4 + 2; // Galaxy radius between 2 and 6 units
                const particleCount = Math.floor(Math.random() * 5000) + 2000;

                // Position galaxies at a believable distance from each other
                let x, y, z;
                do {
                    x = (Math.random() - 0.5) * 100;
                    y = (Math.random() - 0.5) * 100;
                    z = (Math.random() - 0.5) * 100;
                } while (Math.sqrt(x*x + y*y + z*z) < minDistance);

                el.setAttribute('galaxy', {
                    radius: radius,
                    particleCount: particleCount,
                    color: color,
                    shape: shape
                });
                el.setAttribute('position', `${x} ${y} ${z}`);

                sceneEl.appendChild(el);
            }
        }

        window.onload = generateGalaxies;
    </script>

    <style>
        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #ar-button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="container">
        <a-scene xr-mode-ui="enabled: false"
                 renderer="colorManagement: true"
                 webxr="requiredFeatures: ['local-floor', 'hand-tracking'], optionalFeatures: ['passthrough'], overlayElement: #overlay">
            <a-camera position="0 1.6 0"></a-camera>
        </a-scene>
        <button id="ar-button">Start AR Mode</button>
    </div>

    <script>
        document.getElementById('ar-button').addEventListener('click', () => {
            const scene = document.querySelector('a-scene');
            if (scene.is('ar-mode')) {
                scene.exitAR();
            } else {
                scene.enterAR();
            }
        });
    </script>
</body>
</html>
